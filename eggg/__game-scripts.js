var OrbitCamera=pc.createScript("orbitCamera");OrbitCamera.attributes.add("distanceMax",{type:"number",default:0,title:"Distance Max",description:"Setting this at 0 will give an infinite distance limit"}),OrbitCamera.attributes.add("distanceMin",{type:"number",default:0,title:"Distance Min"}),OrbitCamera.attributes.add("pitchAngleMax",{type:"number",default:90,title:"Pitch Angle Max (degrees)"}),OrbitCamera.attributes.add("pitchAngleMin",{type:"number",default:-90,title:"Pitch Angle Min (degrees)"}),OrbitCamera.attributes.add("inertiaFactor",{type:"number",default:0,title:"Inertia Factor",description:"Higher value means that the camera will continue moving after the user has stopped dragging. 0 is fully responsive."}),OrbitCamera.attributes.add("focusEntity",{type:"entity",title:"Focus Entity",description:"Entity for the camera to focus on. If blank, then the camera will use the whole scene"}),OrbitCamera.attributes.add("frameOnStart",{type:"boolean",default:!0,title:"Frame on Start",description:'Frames the entity or scene at the start of the application."'}),Object.defineProperty(OrbitCamera.prototype,"distance",{get:function(){return this._targetDistance},set:function(t){this._targetDistance=this._clampDistance(t)}}),Object.defineProperty(OrbitCamera.prototype,"pitch",{get:function(){return this._targetPitch},set:function(t){this._targetPitch=this._clampPitchAngle(t)}}),Object.defineProperty(OrbitCamera.prototype,"yaw",{get:function(){return this._targetYaw},set:function(t){this._targetYaw=t;var i=(this._targetYaw-this._yaw)%360;this._targetYaw=i>180?this._yaw-(360-i):i<-180?this._yaw+(360+i):this._yaw+i}}),Object.defineProperty(OrbitCamera.prototype,"pivotPoint",{get:function(){return this._pivotPoint},set:function(t){this._pivotPoint.copy(t)}}),OrbitCamera.prototype.focus=function(t){this._buildAabb(t,0);var i=this._modelsAabb.halfExtents,e=Math.max(i.x,Math.max(i.y,i.z));e/=Math.tan(.5*this.entity.camera.fov*pc.math.DEG_TO_RAD),e*=2,this.distance=e,this._pivotPoint.copy(this._modelsAabb.center),this._removeInertia()},OrbitCamera.distanceBetween=new pc.Vec3,OrbitCamera.prototype.resetAndLookAtPoint=function(t,i){this.pivotPoint.copy(i),this.entity.setPosition(t),this.entity.lookAt(i);var e=OrbitCamera.distanceBetween;e.sub2(i,t),this.distance=e.length(),this.pivotPoint.copy(i);var a=this.entity.getRotation();this.yaw=this._calcYaw(a),this.pitch=this._calcPitch(a,this.yaw),this._updatePosition()},OrbitCamera.prototype.resetAndLookAtEntity=function(t,i){this._buildAabb(i,0),this.resetAndLookAtPoint(t,this._modelsAabb.center)},OrbitCamera.prototype.reset=function(t,i,e){this.pitch=i,this.yaw=t,this.distance=e},OrbitCamera.prototype.initialize=function(){var t=this,onWindowResize=function(){t._checkAspectRatio()};window.addEventListener("resize",onWindowResize,!1),this._checkAspectRatio(),this._modelsAabb=new pc.BoundingBox,this._buildAabb(this.focusEntity||this.app.root,0),this.entity.lookAt(this._modelsAabb.center),this._pivotPoint=new pc.Vec3,this._pivotPoint.copy(this._modelsAabb.center);var i=this.entity.getRotation();if(this._yaw=this._calcYaw(i),this._pitch=this._clampPitchAngle(this._calcPitch(i,this._yaw)),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0),this._distance=0,this._targetYaw=this._yaw,this._targetPitch=this._pitch,this.frameOnStart)this.focus(this.focusEntity||this.app.root);else{var e=new pc.Vec3;e.sub2(this.entity.getPosition(),this._pivotPoint),this._distance=this._clampDistance(e.length())}this._targetDistance=this._distance,this.on("attr:distanceMin",(function(t,i){this._targetDistance=this._clampDistance(this._distance)})),this.on("attr:distanceMax",(function(t,i){this._targetDistance=this._clampDistance(this._distance)})),this.on("attr:pitchAngleMin",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)})),this.on("attr:pitchAngleMax",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)})),this.on("attr:focusEntity",(function(t,i){this.frameOnStart?this.focus(t||this.app.root):this.resetAndLookAtEntity(this.entity.getPosition(),t||this.app.root)})),this.on("attr:frameOnStart",(function(t,i){t&&this.focus(this.focusEntity||this.app.root)})),this.on("destroy",(function(){window.removeEventListener("resize",onWindowResize,!1)}))},OrbitCamera.prototype.update=function(t){var i=0===this.inertiaFactor?1:Math.min(t/this.inertiaFactor,1);this._distance=pc.math.lerp(this._distance,this._targetDistance,i),this._yaw=pc.math.lerp(this._yaw,this._targetYaw,i),this._pitch=pc.math.lerp(this._pitch,this._targetPitch,i),this._updatePosition()},OrbitCamera.prototype._updatePosition=function(){this.entity.setLocalEulerAngles(this._pitch,this._yaw,0);var t=this.entity.getPosition();t.copy(this.entity.forward),t.scale(-this._distance),t.add(this.pivotPoint),this.entity.setPosition(t)},OrbitCamera.prototype._removeInertia=function(){this._yaw=this._targetYaw,this._pitch=this._targetPitch,this._distance=this._targetDistance},OrbitCamera.prototype._checkAspectRatio=function(){var t=this.app.graphicsDevice.height,i=this.app.graphicsDevice.width;this.entity.camera.horizontalFov=t>i},OrbitCamera.prototype._buildAabb=function(t,i){var e=0;if(t.model){var a=t.model.meshInstances;if(a)for(e=0;e<a.length;e++)0===i?this._modelsAabb.copy(a[e].aabb):this._modelsAabb.add(a[e].aabb),i+=1}for(e=0;e<t.children.length;++e)i+=this._buildAabb(t.children[e],i);return i},OrbitCamera.prototype._calcYaw=function(t){var i=new pc.Vec3;return t.transformVector(pc.Vec3.FORWARD,i),Math.atan2(-i.x,-i.z)*pc.math.RAD_TO_DEG},OrbitCamera.prototype._clampDistance=function(t){return this.distanceMax>0?pc.math.clamp(t,this.distanceMin,this.distanceMax):Math.max(t,this.distanceMin)},OrbitCamera.prototype._clampPitchAngle=function(t){return pc.math.clamp(t,-this.pitchAngleMax,-this.pitchAngleMin)},OrbitCamera.quatWithoutYaw=new pc.Quat,OrbitCamera.yawOffset=new pc.Quat,OrbitCamera.prototype._calcPitch=function(t,i){var e=OrbitCamera.quatWithoutYaw,a=OrbitCamera.yawOffset;a.setFromEulerAngles(0,-i,0),e.mul2(a,t);var s=new pc.Vec3;return e.transformVector(pc.Vec3.FORWARD,s),Math.atan2(s.y,-s.z)*pc.math.RAD_TO_DEG};var MouseInput=pc.createScript("mouseInput");MouseInput.attributes.add("orbitSensitivity",{type:"number",default:.3,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),MouseInput.attributes.add("distanceSensitivity",{type:"number",default:.15,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),MouseInput.prototype.initialize=function(){if(this.sceneOrbit=!0,this.orbitCamera=this.entity.script.orbitCamera,this.orbitCamera){var t=this,onMouseOut=function(o){t.onMouseOut(o)};this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.addEventListener("mouseout",onMouseOut,!1),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.removeEventListener("mouseout",onMouseOut,!1)}))}this.app.mouse.disableContextMenu(),this.lookButtonDown=!1,this.panButtonDown=!1,this.lastPoint=new pc.Vec2},MouseInput.fromWorldPoint=new pc.Vec3,MouseInput.toWorldPoint=new pc.Vec3,MouseInput.worldDiff=new pc.Vec3,MouseInput.prototype.pan=function(t){var o=MouseInput.fromWorldPoint,e=MouseInput.toWorldPoint,i=MouseInput.worldDiff,s=this.entity.camera,n=this.orbitCamera.distance;s.screenToWorld(t.x,t.y,n,o),s.screenToWorld(this.lastPoint.x,this.lastPoint.y,n,e),i.sub2(e,o),this.orbitCamera.pivotPoint.add(i)},MouseInput.prototype.onMouseDown=function(t){if(!0===this.sceneOrbit)switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!0;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!0}},MouseInput.prototype.onMouseUp=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!1;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!1}},MouseInput.prototype.onMouseMove=function(t){pc.app.mouse;this.lookButtonDown?(this.orbitCamera.pitch-=t.dy*this.orbitSensitivity,this.orbitCamera.yaw-=t.dx*this.orbitSensitivity):this.panButtonDown&&this.pan(t),this.lastPoint.set(t.x,t.y)},MouseInput.prototype.onMouseWheel=function(t){this.orbitCamera.distance-=t.wheel*this.distanceSensitivity*(.1*this.orbitCamera.distance),t.event.preventDefault()},MouseInput.prototype.onMouseOut=function(t){this.lookButtonDown=!1,this.panButtonDown=!1};var KeyboardInput=pc.createScript("keyboardInput");KeyboardInput.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera},KeyboardInput.prototype.postInitialize=function(){this.orbitCamera&&(this.startDistance=this.orbitCamera.distance,this.startYaw=this.orbitCamera.yaw,this.startPitch=this.orbitCamera.pitch,this.startPivotPosition=this.orbitCamera.pivotPoint.clone())},KeyboardInput.prototype.update=function(t){this.orbitCamera&&this.app.keyboard.wasPressed(pc.KEY_SPACE)&&(this.orbitCamera.reset(this.startYaw,this.startPitch,this.startDistance),this.orbitCamera.pivotPoint=this.startPivotPosition)};var TouchInput=pc.createScript("touchInput");TouchInput.attributes.add("orbitSensitivity",{type:"number",default:.4,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),TouchInput.attributes.add("distanceSensitivity",{type:"number",default:.2,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),TouchInput.prototype.initialize=function(){this.sceneOrbit=!0,this.orbitCamera=this.entity.script.orbitCamera,this.lastTouchPoint=new pc.Vec2,this.lastPinchMidPoint=new pc.Vec2,this.lastPinchDistance=0,this.orbitCamera&&this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.on("destroy",(function(){this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)})))},TouchInput.prototype.getPinchDistance=function(t,i){var o=t.x-i.x,n=t.y-i.y;return Math.sqrt(o*o+n*n)},TouchInput.prototype.calcMidPoint=function(t,i,o){o.set(i.x-t.x,i.y-t.y),o.scale(.5),o.x+=t.x,o.y+=t.y},TouchInput.prototype.onTouchStartEndCancel=function(t){var i=t.touches;1==i.length?this.lastTouchPoint.set(i[0].x,i[0].y):2==i.length&&(this.lastPinchDistance=this.getPinchDistance(i[0],i[1]),this.calcMidPoint(i[0],i[1],this.lastPinchMidPoint))},TouchInput.fromWorldPoint=new pc.Vec3,TouchInput.toWorldPoint=new pc.Vec3,TouchInput.worldDiff=new pc.Vec3,TouchInput.prototype.pan=function(t){var i=TouchInput.fromWorldPoint,o=TouchInput.toWorldPoint,n=TouchInput.worldDiff,h=this.entity.camera,c=this.orbitCamera.distance;h.screenToWorld(t.x,t.y,c,i),h.screenToWorld(this.lastPinchMidPoint.x,this.lastPinchMidPoint.y,c,o),n.sub2(o,i),this.orbitCamera.pivotPoint.add(n)},TouchInput.pinchMidPoint=new pc.Vec2,TouchInput.prototype.onTouchMove=function(t){if(!0===this.sceneOrbit){var i=TouchInput.pinchMidPoint,o=t.touches;if(1==o.length){var n=o[0];this.orbitCamera.pitch-=(n.y-this.lastTouchPoint.y)*this.orbitSensitivity,this.orbitCamera.yaw-=(n.x-this.lastTouchPoint.x)*this.orbitSensitivity,this.lastTouchPoint.set(n.x,n.y)}else if(2==o.length){var h=this.getPinchDistance(o[0],o[1]),c=h-this.lastPinchDistance;this.lastPinchDistance=h,this.orbitCamera.distance-=c*this.distanceSensitivity*.1*(.1*this.orbitCamera.distance),this.calcMidPoint(o[0],o[1],i),this.pan(i),this.lastPinchMidPoint.copy(i)}}};var ApplyOutline=pc.createScript("applyOutline");ApplyOutline.attributes.add("color",{type:"rgba"}),ApplyOutline.attributes.add("thickness",{type:"number",default:1,min:1,max:10,precision:0,title:"Thickness"}),ApplyOutline.prototype.initialize=function(){this.vec=new pc.Vec3,this.prepare(),window.addEventListener("resize",this.onResize.bind(this)),this.app.on("Ermis:objectOutline:add",(function(e){if(e&&e.model&&-1===e.model.layers.indexOf(this.outlineLayer.id)){var t=e.model.layers.slice();t.push(this.outlineLayer.id),e.model.layers=t}}),this),this.app.on("Ermis:objectOutline:remove",(function(e){if(e&&e.model){var t=e.model.layers.indexOf(this.outlineLayer.id);if(t>-1){var i=e.model.layers.slice();i.splice(t,1),e.model.layers=i}}}),this)},ApplyOutline.prototype.prepare=function(){this.texture=new pc.Texture(this.app.graphicsDevice,{width:2*this.app.graphicsDevice.width,height:2*this.app.graphicsDevice.height,format:pc.PIXELFORMAT_R8_G8_B8_A8,autoMipmap:!0,minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR}),this.renderTarget=new pc.RenderTarget({colorBuffer:this.texture,depth:!0,samples:8}),this.worldLayer=this.app.scene.layers.getLayerByName("World"),this.outlineLayer=this.app.scene.layers.getLayerByName("OutlineLayer"),this.outlineLayer.renderTarget=this.renderTarget,this.outlineCamera=new pc.Entity,this.outlineCamera.addComponent("camera",{clearColor:new pc.Color(0,0,0,0),layers:[this.outlineLayer.id],fov:this.app.root.findByName("Camera").camera.fov}),this.app.root.addChild(this.outlineCamera),this.outlineCamera.camera.priority=0,this.outline=new pc.OutlineEffect(this.app.graphicsDevice,this.thickness),this.outline.color=new pc.Color(0,0,1,1),this.outline.texture=this.texture,this.entity.camera.postEffects.addEffect(this.outline)},ApplyOutline.prototype.onResize=function(){this.entity.camera.postEffects.removeEffect(this.outline),this.app.scene.layers.remove(this.outlineLayer),this.texture.destroy(),this.texture=new pc.Texture(this.app.graphicsDevice,{width:this.app.graphicsDevice.width,height:this.app.graphicsDevice.height,format:pc.PIXELFORMAT_R8_G8_B8_A8,autoMipmap:!0,minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR}),this.renderTarget.destroy(),this.renderTarget=new pc.RenderTarget(this.app.graphicsDevice,this.texture,{depth:!0}),this.outlineLayer.renderTarget=this.renderTarget,this.app.scene.layers.insert(this.outlineLayer,0),this.outline.texture=this.texture,this.entity.camera.postEffects.addEffect(this.outline)},ApplyOutline.prototype.update=function(e){var t=this.entity.getWorldTransform();this.outlineCamera.setPosition(t.getTranslation()),this.outlineCamera.setEulerAngles(t.getEulerAngles()),this.outlineCamera.setLocalScale(t.getScale()),this.outlineCamera.camera.horizontalFov=!(this.app.graphicsDevice.width>this.app.graphicsDevice.height),this.outline.color.copy(this.color)};var ClickToHighlight=pc.createScript("clickToHighlight");ClickToHighlight.prototype.initialize=function(){this.cameraEntity=this.entity,this.previous=void 0,this.interval=0,this.app.touch?this.app.touch.on(pc.EVENT_TOUCHSTART,this.touchStart,this):this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.mouseDown,this)},ClickToHighlight.prototype.update=function(i){this.interval>0&&(this.interval-=1)},ClickToHighlight.prototype.setInterval=function(){this.interval=15},ClickToHighlight.prototype.mouseDown=function(i){2==i.button&&this.doRaycast(i)},ClickToHighlight.prototype.touchStart=function(i){1==i.touches.length&&(this.interval>0?this.doRaycast(i.touches[0]):this.setInterval()),i.event.preventDefault()},ClickToHighlight.prototype.doRaycast=function(i){var t=this.cameraEntity.getPosition(),e=this.cameraEntity.camera.screenToWorld(i.x,i.y,100*this.cameraEntity.camera.farClip),s=this.app.systems.rigidbody.raycastAll(t,e),o=null,r=1e3;for(var h in s)!1===s[h].entity.tags.has("no-select")&&s[h].entity.getPosition().distance(this.cameraEntity.getPosition())<r&&(o=s[h],r=s[h].entity.getPosition().distance(this.cameraEntity.getPosition()));if(o&&o.entity&&o.entity.script)this.focusEntity(o.entity);else if(this.previous){for(var n in this.app.fire("Ermis:objectOutline:remove",this.previous),this.previous.children)this.app.fire("Ermis:objectOutline:remove",this.previous.children[n]);this.app.root.findByName("UI").script.ui.displayObject(null),this.entity.script.orbitCamera.reset(this.entity.script.orbitCamera.yaw,-90,80),this.previous=void 0}},ClickToHighlight.prototype.focusEntity=function(i){if(this.app.root.findByTag("no-select").indexOf(i)>-1){if(this.previous){for(var t in this.app.fire("Ermis:objectOutline:remove",this.previous),this.previous.children)this.app.fire("Ermis:objectOutline:remove",this.previous.children[t]);this.app.root.findByName("UI").script.ui.displayObject(null),this.entity.script.orbitCamera.reset(this.entity.script.orbitCamera.yaw,-90,80),this.previous=void 0}}else{for(var e in this.app.fire("Ermis:objectOutline:add",i),i.children)this.app.fire("Ermis:objectOutline:add",i.children[e]);if(this.entity.script.orbitCamera.focus(i),this.previous&&this.previous._guid!==i._guid)for(var s in this.app.fire("Ermis:objectOutline:remove",this.previous),this.previous.children)this.app.fire("Ermis:objectOutline:remove",this.previous.children[s]);this.previous=i,this.app.root.findByName("UI").script.ui.displayObject(i)}};Object.assign(pc,function(){var OutlineEffect=function(e,t){pc.PostEffect.call(this,e),this.shader=new pc.Shader(e,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+e.precision+" float;","","#define THICKNESS "+t.toFixed(0),"uniform float uWidth;","uniform float uHeight;","uniform vec4 uOutlineCol;","uniform sampler2D uColorBuffer;","uniform sampler2D uOutlineTex;","","varying vec2 vUv0;","","void main(void)","{","    vec4 texel1 = texture2D(uColorBuffer, vUv0);","    float sample0 = texture2D(uOutlineTex, vUv0).a;","    float outline = 0.0;","    if (sample0==0.0)","    {","        for (int x=-THICKNESS;x<=THICKNESS;x++)","        {","            for (int y=-THICKNESS;y<=THICKNESS;y++)","            {    ","                float sample=texture2D(uOutlineTex, vUv0+vec2(float(x)/uWidth, float(y)/uHeight)).a;","                if (sample>0.0)","                {","                    outline=1.0;","                }","            }","        } ","    }","    gl_FragColor = mix(texel1, uOutlineCol, outline * uOutlineCol.a);","}"].join("\n")}),this.color=new pc.Color(1,1,1,1),this.texture=new pc.Texture(e),this.texture.name="pe-outline"};(OutlineEffect.prototype=Object.create(pc.PostEffect.prototype)).constructor=OutlineEffect;var e=[0,0,0,0];return Object.assign(OutlineEffect.prototype,{render:function(t,i,o){var r=this.device,u=r.scope;u.resolve("uWidth").setValue(t.width),u.resolve("uHeight").setValue(t.height),e[0]=this.color.r,e[1]=this.color.g,e[2]=this.color.b,e[3]=this.color.a,u.resolve("uOutlineCol").setValue(e),u.resolve("uColorBuffer").setValue(t.colorBuffer),u.resolve("uOutlineTex").setValue(this.texture),pc.drawFullscreenQuad(r,i,this.vertexBuffer,this.shader,o)}}),{OutlineEffect:OutlineEffect}}());var Outline=pc.createScript("outline");Outline.attributes.add("color",{type:"rgb",default:[.5,.5,.5,1],title:"Color"}),Outline.attributes.add("texture",{type:"asset",assetType:"texture",title:"Texture"}),Outline.prototype.initialize=function(){this.effect=new pc.OutlineEffect(this.app.graphicsDevice),this.effect.color=this.color,this.effect.texture=this.texture.resource;var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",(function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect)})),this.on("attr:color",(function(e){this.effect.color=e}),this),this.on("attr:texture",(function(e){this.effect.texture=e?e.resource:null}),this)};var Slicer=pc.createScript("slicer");Slicer.prototype.initialize=function(){this.fireTime=0,this.bullet=[],this.entity.children[1].animation.play("Slicer Idle"),this.entity.children[1].animation.loop=!0,this.entity.on("upgrade",this.checkUpgrades,this),this.entity.script.tower.setUp({fireRate:.75,radius:40,damage:120}),this.fthr="none"},Slicer.prototype.update=function(t){new pc.Color(1,1,1),new pc.Color(1,1,1);if(this.fireTime<0)if(this.entity.script.tower.engageList.length>0){this.entity.script.tower.engaged=!0;var e=this.entity.script.tower.engageList[this.entity.script.tower.engageList.length-1].getLocalPosition();this.entity.children[1].lookAt(e.x,this.entity.getLocalPosition().y-1,e.z),this.entity.children[1].animation.play("Slicer Fire"),this.entity.sound.play("Slot 1"),this.bullet=this.fireRound(),this.resetFire()}else!0===this.entity.script.tower.engaged&&(this.entity.script.tower.engaged=!1,this.resetFire());else this.fireTime-=t},Slicer.prototype.fireRound=function(){for(var t=1;t<4;t++){var e=this.app.assets.get(52300348).resource.instantiate();e.setPosition(this.entity.findByName("Target").getPosition()),e.setEulerAngles(this.entity.findByName("Target").getEulerAngles().x,this.entity.findByName("Target").getEulerAngles().y-20+20*t,this.entity.findByName("Target").getEulerAngles().z),e.translateLocal(0,-1,0),this.app.root.addChild(e),this.pierce&&(e.children[0].model.meshInstances[0].material=this.app.assets.get(52214437).resource,e.script.feather.hitCount=1),e.script.feather.damage=this.entity.script.tower.damage,e.script.feather.initEntity=this.entity,e.script.feather.behavior=this.fthr,this.farther&&(e.script.feather.scale=1.7,e.script.feather.duration=.9,this.limit=.7)}},Slicer.prototype.resetFire=function(){!0===this.entity.script.tower.engaged&&(this.entity.children[1].animation.speed=this.entity.script.tower.fireRate,this.entity.children[1].animation.loop=!1,this.fireTime=this.entity.children[1].animation.duration/this.entity.script.tower.fireRate),!1===this.entity.script.tower.engaged&&(this.accelerometer&&(this.entity.script.tower.fireRate=this.accelerometer.base),this.entity.children[1].animation.speed=1,this.entity.children[1].animation.loop=!0,this.entity.children[1].animation.play("Slicer Idle"),this.fireTime=0)},Slicer.prototype.checkUpgrades=function(){!0===this.entity.script.tower.configMain.upgrades[3].owned&&(this.entity.children[1].model.asset=this.app.assets.get(64966459),this.entity.children[1].model.meshInstances[1].material=this.app.assets.get(52248429).resource,this.fthr="return"),!0===this.entity.script.tower.configMain.upgrades[4].owned&&(this.entity.children[1].model.asset=this.app.assets.get(64966459),this.entity.children[1].model.meshInstances[1].material=this.app.assets.get(52214437).resource,this.fthr="fork"),!0===this.entity.script.tower.configMain.upgrades[0].owned&&(this.entity.children[1].model.meshInstances[4].material=this.app.assets.get(52216574).resource,this.entity.script.tower.fireRate=1.3),!0===this.entity.script.tower.configMain.upgrades[1].owned&&(this.entity.children[1].model.meshInstances[5].material=this.app.assets.get(52291372).resource,this.farther=!0),!0===this.entity.script.tower.configMain.upgrades[2].owned&&(this.entity.children[1].model.meshInstances[6].material=this.app.assets.get(51881129).resource,this.pierce=!0)};var EnemyProto=pc.createScript("enemyProto");EnemyProto.attributes.add("class",{type:"string"}),EnemyProto.attributes.add("callName",{type:"string"}),EnemyProto.attributes.add("speed",{type:"number",default:50}),EnemyProto.attributes.add("harm",{type:"number",default:5}),EnemyProto.attributes.add("defense",{type:"number",default:0}),EnemyProto.attributes.add("immunities",{type:"string",array:!0}),EnemyProto.attributes.add("worth",{type:"number",default:20}),EnemyProto.attributes.add("configFile",{type:"asset"}),EnemyProto.prototype.initialize=function(){this.configFile&&(this.config=JSON.parse(this.configFile.resources[0])),this.damagedInterval=0,this.force=new pc.Vec3,this.damagedBy=null,this.health=100,this.entity.findByName("Core").collision.on("contact",this.contact,this),this.effects={slow:0,rot:0},this.init(this.callName)},EnemyProto.prototype.init=function(t){if(this.config[t]){var e=this.config[t];this.initProto(e.proto),this.class=e.class,this.speed=e.speed,this.harm=e.harm,this.defense=e.defense,this.immunities=e.immunities,this.worth=e.worth,e.splitter&&this.entity.on("death",(function(){this.splitter(e.splitter,e.proto.height)}),this)}},EnemyProto.prototype.initProto=function(t){this.entity.collision.halfExtents=new pc.Vec3(t.boundingBox.x,t.boundingBox.y,t.boundingBox.z);var e=this.entity.up.clone().scale(t.height);for(var i of(this.entity.rigidbody.teleport(this.entity.getPosition().add(e)),this.entity.findByName("Core").rigidbody.teleport(this.entity.getPosition().sub(e)),this.entity.findByName("Group").translateLocal(0,t.uiOffset,0),this.entity.findByName("Entity").model.asset=this.app.assets.get(t.model),t.matOverrides))this.entity.findByName("Entity").model.meshInstances[i[0]].material=this.app.assets.get(i[1]).resource;this.entity.findByName("Entity").animation.animations={Movement:this.app.assets.get(t.anim).resource},t.animSpeed&&(this.entity.findByName("Entity").animation.speed=t.animSpeed)},EnemyProto.prototype.initProto2=function(t){this.entity.collision.halfExtents=new pc.Vec3(t.boundingBox.x,t.boundingBox.y,t.boundingBox.z);var e=this.entity.up.clone().scale(t.height);for(var i of(this.entity.rigidbody.teleport(this.entity.getPosition().add(e)),this.entity.findByName("Core").rigidbody.teleport(this.entity.getPosition().sub(e)),this.entity.findByName("Group").translateLocal(0,t.uiOffset,0),this.entity.findByName("Entity").model.asset=this.app.assets.get(t.model),t.matOverrides))this.entity.findByName("Entity").model.meshInstances[i[0]].material=this.app.assets.get(i[1]).resource;this.entity.findByName("Entity").animation.animations={Movement:this.app.assets.get(t.anim).resource},t.animSpeed&&(this.entity.findByName("Entity").animation.speed=t.animSpeed)},EnemyProto.prototype.update=function(t){this.health=pc.math.clamp(this.health,0,100);this.app.root.findByName("Coop").getPosition();this.entity.findByName("Group").lookAt(this.app.root.findByName("Camera").getPosition());var e=this.speed;for(var i in this.effects.slow>0&&(e/=2.4),this.forceVal=this.entity.forward.clone().scale(e/100),this.entity.rigidbody.teleport(this.entity.getPosition().add(this.forceVal)),this.entity.findByName("Progress").element.width=this.health/100*3,this.effects)this.effects[i]>0&&(this.effects[i]-=t);this.health<1&&(this.app.root.findByName("Coop").script.coop.tokenADD(this.worth),this.end()),this.effects.rot>0&&(this.health-=.3)},EnemyProto.prototype.applyDamage=function(t,e){this.damagedInterval=.1,this.health-=t-t*(this.defense/100),this.damagedBy=e},EnemyProto.prototype.end=function(){this.damagedBy&&this.damagedBy.fire("killCount"),this.entity.fire("death"),this.entity.destroy()},EnemyProto.prototype.applyEffect=function(t,e){this.damagedBy=e,"slow"==t.name&&(this.effects.slow=t.duration),"rot"==t.name&&(this.effects.rot=t.duration)},EnemyProto.prototype.contact=function(t){"Guide"==t.other.name&&(this.entity.rigidbody.teleport(this.entity.getPosition(),t.other.getEulerAngles()),this.entity.findByName("Group").lookAt(this.app.root.findByName("Camera").getPosition()))},EnemyProto.prototype.splitter=function(t,e){for(var i=0;i<t.amount;i++){var o=this.app.assets.get(52021162).resource.instantiate();o.setPosition(this.entity.getPosition()),o.setEulerAngles(this.entity.getEulerAngles()),o.translateLocal(0,-e,t.distance*i),o.script.enemyProto.callName=t.callName,this.app.root.addChild(o),o.enabled=!0}};var Tower=pc.createScript("tower");Tower.attributes.add("config",{type:"asset"}),Tower.prototype.initialize=function(){this.config&&(this.configMain=JSON.parse(this.config.resources[0])),this.fireRate=1,this.radius=1,this.damage=1,this.engageList=[],this.exclusionTags=[],this.inclusionTags=["enemy"],this.engaged=!1,this.killCount=0,this.entity.children[0].collision.on("triggerenter",(function(i){this.enemyPush(i)}),this),this.entity.children[0].collision.on("triggerleave",(function(i){this.enemyPop(i)}),this),this.entity.on("killCount",this.killTick,this)},Tower.prototype.setUp=function(i){this.fireRate=i.fireRate,this.radius=i.radius,this.damage=i.damage},Tower.prototype.killTick=function(){this.killCount+=1},Tower.prototype.update=function(i){this.entity.findByName("Radius")&&(this.entity.findByName("Radius").collision.radius=this.radius,this.entity.findByName("Radius").setLocalScale(2*this.radius,0,2*this.radius))},Tower.prototype.enemyPush=function(i){"Coop"==this.entity.name?this.inclusionTags.filter((t=>i.tags.has(t))).length>0&&(this.entity.script.coop.health=pc.math.clamp(this.entity.script.coop.health-i.script.enemyProto.harm,0,100),i.destroy()):this.inclusionTags.filter((t=>i.tags.has(t))).length>0&&this.exclusionTags.filter((t=>i.tags.has(t))).length<1&&this.engageList.push(i)},Tower.prototype.enemyPop=function(i){this.engageList.indexOf(i)>-1&&this.engageList.splice(this.engageList.indexOf(i),1)};var Ui=pc.createScript("ui");Ui.prototype.initialize=function(){for(var t in this.set=[],this.config=null,this.focusEntity=null,this.listUp=!0,this.entity.children)this.entity.children[t].element.on("mouseenter",(function(t){this.app.root.findByName("Camera").script.mouseInput.sceneOrbit=!1}),this),this.entity.children[t].element.on("mouseleave",(function(t){this.app.root.findByName("Camera").script.mouseInput.sceneOrbit=!0}),this),this.entity.children[t].element.on("touchstart",(function(t){this.app.root.findByName("Camera").script.touchInput.sceneOrbit=!1}),this),this.entity.children[t].element.on("touchend",(function(t){this.app.root.findByName("Camera").script.touchInput.sceneOrbit=!0}),this);this.entity.findByName("Start Button").element.on("click",(function(t){this.entity.findByName("Message Group").enabled=!1,this.app.root.findByName("Spawner").script.main.start()}),this),this.populate(),this.entity.findByName("Arrow").element.on("click",(function(t){this.entity.findByName("Arrow").rotateLocal(0,0,180),!0===this.listUp?(this.entity.findByName("Tower Group").translateLocal(0,-400,0),this.listUp=!1):(this.entity.findByName("Tower Group").translateLocal(0,400,0),this.listUp=!0)}),this),this.entity.findByName("Sell Button").element.on("click",(function(t){if(this.focusEntity&&this.config){var e=this.app.root.findByName("Coop").script.coop.towersActive.indexOf(this.focusEntity);this.entity.sound.play("Slot 2"),this.app.root.findByName("Coop").script.coop.tokens+=this.config.sellBack,this.app.root.findByName("Coop").script.coop.towersActive.splice(e,1),this.focusEntity.destroy(),this.focusEntity=null,this.config=null}}),this)},Ui.prototype.update=function(t){null===this.focusEntity?(this.entity.findByName("Info Group").enabled=!1,this.app.root.findByName("RadiusViewer").setPosition(0,4,0),this.app.root.findByName("RadiusViewer").setLocalScale(1,1,1)):(this.entity.findByName("Info Group").enabled=!0,this.focusEntity.findByName("Radius")?(this.app.root.findByName("RadiusViewer").setPosition(this.focusEntity.getPosition().x,10.7,this.focusEntity.getPosition().z),this.app.root.findByName("RadiusViewer").setLocalScale(2*this.focusEntity.script.tower.radius,.1,2*this.focusEntity.script.tower.radius)):(this.app.root.findByName("RadiusViewer").setPosition(0,4,0),this.app.root.findByName("RadiusViewer").setLocalScale(1,1,1))),this.entity.findByName("Tokens").element.text="Tokens: "+this.app.root.findByName("Coop").script.coop.tokens,this.entity.findByName("Health Bar").element.width=this.app.root.findByName("Coop").script.coop.health/100*390,this.hen(this.app.root.findByName("Coop").script.coop.hens),this.config&&(!0===this.config.canSell?(this.entity.findByName("Info Card").enabled=!0,this.entity.findByName("SellBack").element.text=this.config.sellBack+" Tokens"):this.entity.findByName("Info Card").enabled=!1)},Ui.prototype.hen=function(t){switch(t){case 3:this.entity.findByName("Hens").element.texture=this.app.assets.get(52063655).resource;break;case 2:this.entity.findByName("Hens").element.texture=this.app.assets.get(52063835).resource;break;case 1:this.entity.findByName("Hens").element.texture=this.app.assets.get(52063846).resource;break;case 0:this.entity.findByName("Hens").element.texture=this.app.assets.get(52063877).resource}},Ui.prototype.displayObject=function(t){if(this.focusEntity=t,t&&t.script){for(var e in this.config=this.focusEntity.script.tower.configMain,this.set)e<this.config.upgrades.length?(!0===this.config.upgrades[e].owned?(this.set[e].findByName("Status").element.text="OWNED",this.set[e].button.active=!1):"exc"==this.config.upgrades[e].owned?(this.set[e].findByName("Status").element.text="LOCKED",this.set[e].button.inactiveTint=new pc.Color(.55,.55,.55),this.set[e].button.active=!1):(this.set[e].findByName("Status").element.text="UPGRADE",this.set[e].button.inactiveTint=new pc.Color(.6,.86,.65),this.set[e].button.active=!0),this.config.upgrades[e].linkList?this.set[e].findByName("Link").enabled=!0:this.set[e].findByName("Link").enabled=!1,this.set[e].enabled=!0,this.set[e].findByName("Name").element.text=this.config.upgrades[e].name,this.set[e].findByName("Description").element.text=this.config.upgrades[e].description,this.set[e].findByName("Cost").element.text=this.config.upgrades[e].cost+" Tokens"):this.set[e].enabled=!1;this.entity.findByName("Title").element.text=this.config.name}},Ui.prototype.populate=function(){var t=this.entity.findByName("Upgrade Card");this.set.push(t);for(var e=1;e<10;e++){var i=t.clone();this.set.push(i),this.entity.findByName("Content").addChild(i),i.translateLocal(0,-220*e,0),i.element.on("click",(function(t){this.buttonEvent(t.element.entity)}),this)}t.element.on("click",(function(t){this.buttonEvent(t.element.entity)}),this)},Ui.prototype.buttonEvent=function(t){var e=this.config.upgrades[this.set.indexOf(t)].cost,i=this.config.upgrades[this.set.indexOf(t)].linkList;if(e<=this.app.root.findByName("Coop").script.coop.tokens&&!0===t.button.active){if(this.app.root.findByName("Coop").script.coop.tokens-=e,t.button.active=!1,this.config.upgrades[this.set.indexOf(t)].owned=!0,t.findByName("Status").element.text="OWNED",i)for(var n in i)this.config.upgrades[i[n]].owned="exc",this.set[i[n]].findByName("Status").element.text="LOCKED",this.set[i[n]].button.inactiveTint=new pc.Color(.55,.55,.55),this.set[i[n]].button.active=!1;this.config.sellBack+=Math.floor(.5*e),this.focusEntity.fire("upgrade"),this.entity.sound.play("Slot 1")}},Ui.prototype.pushMessage=function(t,e){this.entity.findByName("Message Group").enabled=!0,this.entity.findByName("Round").element.text="Round: "+t,this.entity.findByName("Message").element.text=e};var Coop=pc.createScript("coop");Coop.prototype.initialize=function(){this.health=100,this.tokens=1e3,this.hens=3,this.towersActive=[]},Coop.prototype.update=function(t){this.health=pc.math.clamp(this.health,0,100),this.health<1&&this.hens>0&&(this.health=100,this.hens-=1)},Coop.prototype.tokenADD=function(t){this.tokens+=t};var Main=pc.createScript("main");Main.attributes.add("configFile",{type:"asset"}),Main.prototype.initialize=function(){this.trigger=0,this.active=!1,this.configFile&&(this.config=JSON.parse(this.configFile.resources[0])),this.index=0,this.sp_ind=0,this.round=this.config[0],this.app.root.findByName("UI").script.ui.pushMessage(this.round.num,this.round.description)},Main.prototype.update=function(i){!0===this.active&&(this.round.spawns.length>this.sp_ind?this.trigger<0?(this.trigger=this.round.spawns[this.sp_ind].duration,1==this.round.spawns[this.sp_ind].amount?(this.spawn(this.round.spawns[this.sp_ind]),this.sp_ind+=1):(this.spawn(this.round.spawns[0]),this.round.spawns[this.sp_ind].amount-=1)):this.trigger-=i:this.round.spawns.length<=this.sp_ind&&this.app.root.find("name","Enemy").length<1&&this.stop(this.round.num,this.round.description))},Main.prototype.stop=function(i,t){!0===this.active&&(this.index+=1,this.round=this.config[this.index],this.round&&this.app.root.findByName("UI").script.ui.pushMessage(this.round.num,this.round.description),this.active=!1)},Main.prototype.start=function(){this.active=!0,this.sp_ind=0},Main.prototype.spawn=function(i){if("wait"!==i.name)for(var t in this.entity.children){var s=this.app.assets.get(52021162).resource.instantiate();s.setPosition(this.entity.children[t].getPosition()),s.setEulerAngles(this.entity.children[t].getEulerAngles()),s.script.enemyProto.callName=i.name,this.app.root.addChild(s),s.enabled=!0}};var Summoner=pc.createScript("summoner");Summoner.attributes.add("asset_id",{type:"number"}),Summoner.attributes.add("cost",{type:"number"}),Summoner.attributes.add("name",{type:"string"}),Summoner.attributes.add("range",{type:"number"}),Summoner.prototype.initialize=function(){this.canPlace=!1,this.def=null,this.ray=new pc.Ray,this.cameraEntity=this.app.root.findByName("Camera"),this.state="release",this.entity.element.on("click",(function(t){0===t.button&&"release"==this.state&&"release"==this.state&&this.ready("init")}),this),this.entity.element.on("touchstart",(function(t){"release"==this.state&&this.ready("init")}),this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchMove,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchEnd,this)),this.entity.findByName("Cost").element.text=this.cost+" Tokens",this.entity.findByName("Text").element.text=this.name},Summoner.prototype.onMouseMove=function(t){"dragging"==this.state||(this.app.root.findByName("Radius Previewer").setPosition(0,0,0),this.app.root.findByName("Radius Previewer").setLocalScale(1,1,1))},Summoner.prototype.onMouseDown=function(t){"dragging"==this.state&&(0===t.button?(this.doRayCast(t),this.ready("place")):(this.kill(),this.entity.button.active=!0))},Summoner.prototype.onTouchMove=function(t){1==t.touches.length&&"dragging"==this.state&&1==this.canPlace&&(this.doRayCast(t.touches[0]),this.ready("place"),this.canPlace=!1)},Summoner.prototype.onTouchEnd=function(t){0==this.canPlace&&"dragging"==this.state&&(this.canPlace=!0)},Summoner.prototype.doRayCast=function(t){var e=this.cameraEntity.getPosition(),i=this.cameraEntity.camera.screenToWorld(t.x,t.y,this.cameraEntity.camera.farClip),s=this.app.systems.rigidbody.raycastAll(e,i),o=null,a=1e3;for(var n in s)"Map"!=s[n].entity.name&&"No Zone"!=s[n].entity.name||s[n].entity.getPosition().y<a&&(o=s[n],a=s[n].entity.getPosition().y);o&&this.def&&(this.def.rigidbody.teleport(o.point.x,o.point.y+3,o.point.z),this.app.root.findByName("Radius Previewer").setPosition(this.def.getPosition().x,10.8,this.def.getPosition().z),this.app.root.findByName("Radius Previewer").setLocalScale(2*this.range,.1,2*this.range),"No Zone"==o.entity.name?(this.app.root.findByName("Radius Previewer").model.meshInstances[0].material=this.app.assets.get(52248028).resource,this.canPlace=!1):(this.app.root.findByName("Radius Previewer").model.meshInstances[0].material=this.app.assets.get(52187915).resource,this.canPlace=!0))},Summoner.prototype.update=function(t){this.app.keyboard.wasPressed(pc.KEY_ESCAPE)&&this.kill()},Summoner.prototype.ready=function(t){var e=this.app.root.findByName("Coop").script.coop.tokens;if("init"==t&&e>=this.cost){var i=this.app.assets.get(this.asset_id);this.def=i.resource.instantiate(),this.app.root.addChild(this.def),this.def.setPosition(0,0,-17),this.entity.button.active=!1,this.state="dragging"}if("place"==t&&this.def&&!0===this.canPlace){for(var s in this.def.script.enabled=!0,this.def.script.scripts)this.def.script.scripts[s].initialize();this.state="release",this.app.root.findByName("Coop").script.coop.tokens-=this.cost,this.app.root.findByName("UI").sound.play("Slot 3"),this.app.root.findByName("Coop").script.coop.towersActive.length<1&&this.cameraEntity.script.clickToHighlight.focusEntity(this.def),this.app.root.findByName("Coop").script.coop.towersActive.push(this.def),this.def=null,this.entity.button.active=!0}},Summoner.prototype.kill=function(){this.def&&(this.def.destroy(),this.def=null,this.state="release")};var Frag=pc.createScript("frag");Frag.prototype.initialize=function(){this.damage=0,this.endRadius=0,this.currentRadius=.1,this.initEntity=null,this.entity.collision.on("triggerenter",(function(t){this.hurt(t)}),this),this.entity.collision.radius=6,this.effect=null},Frag.prototype.update=function(t){this.currentRadius>6?this.entity.destroy():(this.currentRadius+=1.5,console.log(this.initEntity),this.entity.setLocalScale(2*this.currentRadius,2*this.currentRadius,2*this.currentRadius))},Frag.prototype.hurt=function(t){t&&t.script&&t.script.enemyProto&&(t.script.enemyProto.applyDamage(this.damage,this.initEntity),this.effect&&t.script.enemyProto.applyEffect(this.effect,this.initEntity))};var Turret=pc.createScript("turret");Turret.prototype.initialize=function(){this.fireTime=0,this.bulletTime=0,this.bullet=[],this.entity.children[1].animation.play("Turret(Base) Idle"),this.entity.children[1].animation.loop=!0,this.entity.on("upgrade",this.checkUpgrades,this),this.entity.script.tower.setUp({fireRate:5,radius:25,damage:36}),this.memento=-1},Turret.prototype.update=function(t){var e=new pc.Color(1,1,1),i=new pc.Color(1,1,1);if(this.fireTime<0)if(this.entity.script.tower.engageList.length>0){this.entity.script.tower.engaged=!0;var s=this.entity.script.tower.engageList[this.entity.script.tower.engageList.length-1].getLocalPosition();this.entity.children[1].lookAt(s.x,s.y,s.z),this.entity.children[1].animation.play("Turret(Base) Fire"),this.entity.sound.play("Slot 1"),this.bullet=this.fireRound(),this.memento>=1&&(1==this.memento&&(this.entity.children[1].model.meshInstances[1].material=this.app.assets.get(51881129).resource),this.entity.sound.play("Slot 2"),this.memento-=1),this.memento>-1&&this.memento<1&&(this.memento-=.5),this.bulletTime=.2,this.resetFire()}else!0===this.entity.script.tower.engaged&&(this.entity.script.tower.engaged=!1,this.resetFire());else this.fireTime-=t;this.bulletTime>0&&(i.a=this.bulletTime/.2,e.a=this.bulletTime/.2-2,this.app.renderLine(this.bullet[0],this.bullet[1],e,i),this.bulletTime-=t)},Turret.prototype.fireRound=function(){this.accelerometer&&(this.entity.script.tower.fireRate=pc.math.clamp(this.entity.script.tower.fireRate+.2,this.accelerometer.base,this.accelerometer.max));var t=1;this.memento>0&&(t=4);var e=this.entity.children[1].getPosition(),i=new pc.Vec3;i.add2(e,this.entity.children[1].children[0].forward.mulScalar(this.entity.script.tower.radius+10));var s=this.app.systems.rigidbody.raycastAll(e,i);for(var r in s){var n=s[r];if(n&&n.entity&&n.entity.tags.has("shield"))return[this.entity.children[1].children[0].getPosition(),n.entity.getPosition(),!1];if(n&&n.entity.script&&n.entity.script.enemyProto){if(this.frag){var a=this.app.assets.get(52218912).resource.instantiate();this.app.root.addChild(a),a.script.enabled=!0,a.setPosition(n.entity.getPosition()),a.script.frag.damage=this.entity.script.tower.damage*t,a.script.frag.initEntity=this.entity,a.script.frag.endRadius=8,a.script.frag.effect=this.debuff}else n.entity.script.enemyProto.applyDamage(this.entity.script.tower.damage*t,this.entity),this.debuff&&n.entity.script.enemyProto.applyEffect(this.debuff,this.entity);return[this.entity.children[1].children[0].getPosition(),n.entity.getPosition(),!0]}}return[this.entity.children[1].children[0].getPosition(),i,!1]},Turret.prototype.resetFire=function(){!0===this.entity.script.tower.engaged&&(this.entity.children[1].animation.speed=this.entity.script.tower.fireRate,this.entity.children[1].animation.loop=!1,this.fireTime=this.entity.children[1].animation.duration/this.entity.script.tower.fireRate),!1===this.entity.script.tower.engaged&&(this.accelerometer&&(this.entity.script.tower.fireRate=this.accelerometer.base),this.entity.children[1].animation.speed=1,this.entity.children[1].animation.loop=!0,this.entity.children[1].animation.play("Turret(Base) Idle"),this.fireTime=0)},Turret.prototype.checkUpgrades=function(){!0===this.entity.script.tower.configMain.upgrades[3].owned&&(this.entity.children[1].model.asset=this.app.assets.get(52213615),this.entity.children[1].model.meshInstances[2].material=this.app.assets.get(52214683).resource,this.debuff={name:"rot",duration:3}),!0===this.entity.script.tower.configMain.upgrades[4].owned&&(this.entity.children[1].model.asset=this.app.assets.get(52213615),this.entity.children[1].model.meshInstances[2].material=this.app.assets.get(52216470).resource,this.debuff={name:"slow",duration:2}),!0===this.entity.script.tower.configMain.upgrades[5].owned&&(this.entity.children[1].model.asset=this.app.assets.get(52213615),this.entity.children[1].model.meshInstances[2].material=this.app.assets.get(52214437).resource,this.entity.on("killCount",this.memMori,this)),!0===this.entity.script.tower.configMain.upgrades[0].owned&&(this.entity.children[1].model.meshInstances[4].material=this.app.assets.get(52216574).resource,this.entity.script.tower.radius=40),!0===this.entity.script.tower.configMain.upgrades[1].owned&&(this.entity.children[1].model.meshInstances[5].material=this.app.assets.get(51982608).resource,this.accelerometer={base:5.5,max:10}),!0===this.entity.script.tower.configMain.upgrades[2].owned&&(this.entity.children[1].model.meshInstances[6].material=this.app.assets.get(51881129).resource,this.frag=!0)},Turret.prototype.memMori=function(){-1===this.memento&&(this.entity.children[1].model.meshInstances[1].material=this.app.assets.get(52276431).resource,this.memento=6)};var Feather=pc.createScript("feather");Feather.prototype.initialize=function(){this.entity.collision.on("collisionstart",(function(t){this.hurt(t.other)}),this),this.damage=0,this.initEntity=null,this.duration=.6,this.scale=1,this.hitCount=0,this.behavior="none",this.rot=30,this.dir=1,this.limit=.4},Feather.prototype.update=function(t){this.entity.children[0].rotateLocal(0,this.rot*this.scale,0),this.forceVal=this.entity.forward.clone().scale(this.scale),this.dir>0?this.entity.rigidbody.teleport(this.entity.getPosition().add(this.forceVal)):this.entity.rigidbody.teleport(this.entity.getPosition().sub(this.forceVal)),this.duration<0?this.entity.destroy():(this.duration<.1&&this.dir>0&&"return"==this.behavior&&(this.duration=this.limit*this.scale+.1,this.dir=-1),this.duration<this.limit*this.scale&&"fork"==this.behavior&&(this.behavior="none",this.fireRound()),this.duration-=t)},Feather.prototype.hurt=function(t){t&&t.script&&t.script.enemyProto&&(t.script.enemyProto.applyDamage(this.damage,this.initEntity),0===this.hitCount&&this.entity.destroy())},Feather.prototype.fireRound=function(){var t=this.app.assets.get(52300348).resource.instantiate();t.setPosition(this.entity.getPosition()),t.setEulerAngles(this.entity.getEulerAngles().x,this.entity.getEulerAngles().y-20+40,this.entity.getEulerAngles().z),t.translateLocal(0,-1,0),this.app.root.addChild(t),t.children[0].model.meshInstances[0].material=this.entity.children[0].model.meshInstances[0].material,t.script.feather.damage=this.damage,t.script.feather.initEntity=this.initEntity,t.script.feather.scale=this.scale,t.script.feather.duration=this.duration};

//# sourceMappingURL=__game-scripts.js.map